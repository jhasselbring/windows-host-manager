name: Auto build & Release

on: push

jobs:
  build_on_win:
    runs-on: windows-latest

    steps:
    - uses: actions/checkout@master
      with:
        ref: feature/github-actions  

    - uses: actions/setup-node@master
      with:
        node-version: 10.16

    - name: install node tools
      run: npm install --global --production windows-build-tools@4.0.0

    - name: install node-gyp
      run: npm install --global node-gyp@latest

    - name: Install dependencies
      run: npm install

    - name: Build Electron
      run: npm run electron:build

    - uses: lucyio/upload-to-release@master
      with:
        name: lucyio/electron
        path: ./dist_electron/
        action: unpublished
        github_token: ${{ secrets.github_token }}
        release: ${{ startsWith(github.ref, 'refs/tags/v') }}
